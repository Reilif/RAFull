"use strict";angular.module("raApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){d.authenticate&&!a&&b.path("/login")})})}]),angular.module("raApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("raApp").controller("LoginCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("raApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("raApp").controller("SignupCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),angular.module("raApp").controller("AdminCtrl",["$scope","$http","Auth","User","$modal",function(a,b,c,d,e){a.users=d.query(),a.url="/api/users/download",a.open=function(b){var c=e.open({animation:!0,templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",resolve:{user:function(){return b}}});c.result.then(function(b){a.activate(b)},function(){$log.info("Modal dismissed at: "+new Date)})},a.download=function(a){window.open("/api/users/download/"+a._id)},a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})},a.activate=function(a){b.put("/api/users/"+a.user._id+"/activation",a).success(function(a,b,c,d){a.user.activated=!0}).error(function(a,b,c,d){})}}]),angular.module("raApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","user",function(a,b,c){a.user=c,a.data={},a.data.user=c,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("raApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("raApp").controller("MainCtrl",["$scope","$http",function(a,b){a.awesomeThings=[],b.get("/api/things").success(function(b){a.awesomeThings=b}),a.addThing=function(){""!==a.newThing&&(b.post("/api/things",{name:a.newThing}),a.newThing="")},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)}}]),angular.module("raApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("raApp").controller("MycertificatesCtrl",["$scope",function(a){a.certificates=[],$http.get("/api/certificatess").success(function(b){a.certificates=b}),a.addThing=function(){""!==a.newThing&&($http.post("/api/things",{name:a.newThing}),a.newThing="")},a.deleteThing=function(a){$http["delete"]("/api/things/"+a._id)}}]),angular.module("raApp").config(["$stateProvider",function(a){a.state("mycertificates",{url:"/mycertificates",templateUrl:"app/mycertificates/mycertificates.html",controller:"MycertificatesCtrl"})}]),angular.module("raApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},isActivated:function(){return g.activated},getToken:function(){return e.get("token")}}}]),angular.module("raApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("raApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("raApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("raApp").controller("NavbarCtrl",["$scope","$location","Auth",function(a,b,c){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.logout=function(){c.logout(),b.path("/login")},a.isActive=function(a){return a===b.path()}}]),angular.module("raApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><p>Accounts are reset on server restart from <code>server/config/seed.js</code>. Default account is <code>test@test.com</code> / <code>test</code></p><p>Admin account is <code>admin@admin.com</code> / <code>admin</code></p></div><div class=col-sm-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>Email</label><input type=email name=email class=form-control ng-model=user.email required></div><div class=form-group><label>Password</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.email.$error.required && form.password.$error.required && submitted">Please enter your email and password.</p><p class=help-block ng-show="form.email.$error.email && submitted">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit>Login</button> <a class="btn btn-default btn-lg btn-register" href=/signup>Register</a></div></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1>Passwort ändern</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Aktuelles Passwort</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>Neues passwort</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Passwort muss mindestens 3 Zeichen haben.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Änderungen speichern</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1>Registrierung</h1><p>Dies ist eine Voranmeldung für unseren Service. Da wir ihre Identität zunächst prüfen müssen, wird sich ein Mitarbeiter von uns mit Ihnen in Verbindung setzen um einen Termin zu vereinbaren. Wir bitten um ihr Verständinss.</p></div><div class=col-sm-12><form class=form name=form ng-submit=register(form) novalidate><div class=form-group ng-class="{ \'has-success\': form.name.$valid && submitted,\r\n                                            \'has-error\': form.name.$invalid && submitted }"><label>Name</label><input name=name class=form-control ng-model=user.name required><p class=help-block ng-show="form.name.$error.required && submitted">Es wird ein Name benötigt</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && submitted,\r\n                                            \'has-error\': form.email.$invalid && submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Dies ist keine korrekte E-Mail Adresse</p><p class=help-block ng-show="form.email.$error.required && submitted">Es wird eine E-Mail benötigt</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div><div class=form-group ng-class="{ \'has-success\': form.password.$valid && submitted,\r\n                                            \'has-error\': form.password.$invalid && submitted }"><label>Passwort</label><input type=password name=password class=form-control ng-model=user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && submitted">Das Passwort muss mindestens drei Zeichen haben.</p><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.password }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit>Registrieren</button> <a class="btn btn-default btn-lg btn-register" href=/login>Anmelden</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><table class="table table-striped"><thead><th>Name</th><th>E-Mail Adresse</th><th>Freischalten</th><th>Client-Certificate</th><th class=pull-right>Löschen</th></thead><tbody><tr ng-repeat="user in users"><td>{{user.name}}</td><td>{{user.email}}</td><td><button type=button class="btn btn-primary" ng-click=open(user) ng-show=!user.activated>Benutzer freischalten</button> <span class="glyphicon glyphicon-check" ng-show=user.activated></span></td><td><button type=button class="btn btn-primary" ng-click=download(user) ng-show=user.activated>Zertifikat downloaden</button></td><td><a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></td></tr></tbody></table></div><script type=text/ng-template id=myModalContent.html><div class="modal-header ">\n    <h3 class="modal-title">Freischaltung!</h3>\n  </div>\n  <div class="modal-body">\n    <label>Name</label>\n    <input type="text" class="form-control" ng-model="user.name"\n           disabled/>\n    <label>E-Mail</label>\n    <input type="text" class="form-control" ng-model="user.email"\n           disabled/>\n    <label>Straße/Hausnr.</label>\n    <input type="text"  class="form-control" ng-model="data.street"\n           />\n    <label>PLZ</label>\n    <input type="text"  class="form-control" ng-model="data.zip"\n           />\n    <label>Staat/Bundesland</label>\n    <input type="text"  class="form-control" ng-model="data.state"\n           />\n    <label>Land</label>\n    <input type="text"  class="form-control" ng-model="data.country"\n           />\n    <label>Personalausweisnummer</label>\n    <input type="text"  class="form-control" ng-model="data.idnr"\n           />\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-primary" ng-click="ok()">OK</button>\n    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>\n  </div></script>'),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><header class=hero-unit id=banner><div class=container><h1>Willkommen!</h1><p class=lead>Erstelle und Verwalte deine Zertifikate!</p><img src=../../assets/images/1fb6a604.Zertifikate.png alt="I\'m Yeoman" style="width: 100px"></div></header><div class=container><div class=row><div class=col-lg-12><h1 class=page-header>Features:</h1><ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings"><li><a href=# tooltip={{thing.info}}>{{thing.name}}</a></li></ul></div></div></div><footer class=footer><div class=container><p>Angular Fullstack v2.0.13 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div></footer>'),a.put("app/mycertificates/mycertificates.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><p>Hier findest du alle von dir angelegten Zertifikate. Du kannst bestehende Zertifikate entfernen oder neue anlegen</p><table class="table table-striped"><thead><th>Zertifikatname</th><th>Erstellungsdatum</th><th>Ablaufdatum</th><th class=pull-right>Löschen</th></thead><tbody><tr ng-repeat="cert in certificates"><td>{{cert.name}}</td><td>{{cert.date}}</td><td>{{cert.revokeDate}}</td><td><a ng-click=delete(cert) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></td></tr></tbody></table></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>ra</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Benutzerliste</a></li><li ng-show=isActivated() ng-class="{active: isActive(\'/certificates\')}"><a href=/settings>Zertifikate<span class="glyphicon glyphicon-cog"></span></a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/signup\')}"><a href=/signup>Sign up</a></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/login\')}"><a href=/login>Login</a></li><li ng-show=isLoggedIn()><p class=navbar-text>Hallo {{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/settings\')}"><a href=/settings><span class="glyphicon glyphicon-cog"></span></a></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/logout\')}"><a href="" ng-click=logout()>Logout</a></li></ul></div></div></div>')}]);